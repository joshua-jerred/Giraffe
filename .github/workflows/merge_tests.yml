name: Giraffe Unit Tests

on:
   pull_request:
    branches: [ main ]

jobs:
  setup:
    name: Pull w/Submodules & CMake Configure
    runs-on: self-hosted
    steps:
      - uses: actions/checkout/@v3
        with:
          submodules: recursive
      - name: Configure
        run: mkdir build && cd build && cmake ..

  common_tests_cpp:
    name: Unit Tests / Common C++
    needs: ["setup"]
    runs-on: self-hosted
    steps:
      - name: Build Test
        run: cd build && make unit_test_common
      - name: Run Test
        run: cd build/bin/tests/common && ./unit_test_common

  gfs_tests:
    name: Unit Tests / Giraffe Flight System
    needs: ["setup"]
    runs-on: self-hosted
    steps:
      - name: Build Test
        run: cd build && make unit_test_gfs
      - name: Run Test
        run: cd build/bin/tests/flight_system && ./unit_test_gfs

  data_link_tests:
    name: Unit Tests / Data Link
    needs: ["setup"]
    runs-on: self-hosted
    steps:
      - name: Build Test
        run: cd build && make unit_test_gdl
      - name: Run Test
        run: cd build/bin/tests/data_link && ./unit_test_gdl

  common_tests_js:
    name: Unit Tests / Common JS
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - name: Use Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '18.x'
      - run: npm install
        working-directory: ./src/common/protocol
      - run: npm test
        working-directory: ./src/common/protocol

  ggs_tests:
    name: Unit Tests / Giraffe Ground Station
    runs-on: ubuntu-latest
    needs: ["common_tests_js"]
    steps:
      - uses: actions/checkout@v3
      - name: Use Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '18.x'
      - run: npm install
        working-directory: ./src/ground_station
      - run: npm test
        working-directory: ./src/ground_station

  gwc_tests:
    name: Unit Tests / Giraffe Web Client
    runs-on: ubuntu-latest
    needs: ["common_tests_js"]
    steps:
      - uses: actions/checkout@v3
      - name: Use Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '18.x'
      - run: npm install
        working-directory: ./src/web_client
      - run: npm test
        working-directory: ./src/web_client

  doxygen_build:
    name: Doxygen Build
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - name: Install Doxygen
        run: sudo apt-get install doxygen
      - name: Build Doxygen
        run: doxygen project/doxygen/Doxyfile
      # - name: Deploy to GitHub Pages
      #   uses: peaceiris/actions-gh-pages@v3
      #   with:
      #     github_token: ${{ secrets.GITHUB_TOKEN }}
      #     publish_dir: ./docs